{"version":3,"file":"static/js/466.973c509b.chunk.js","mappings":"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","sources":["components/articles/articleinfo.js","components/articles/optimizememallocation.js","components/breadcrumbs.js","../node_modules/react-gist/es/index.js"],"sourcesContent":["import React from \"react\";\r\n\r\nconst ArticleInfo = ({ category, date, githuburl, summary }) => {\r\n  let githublink;\r\n  if (githuburl) {\r\n    githublink = (\r\n      <a href={githuburl} target=\"_blank\">\r\n        GitHub\r\n      </a>\r\n    );\r\n  } else { githublink = \" - \";}\r\n  \r\n  return (\r\n    <div className=\"col-lg-4\">\r\n      <div className=\"portfolio-info\">\r\n        <h3>Information</h3>\r\n        <ul>\r\n          <li>\r\n            <strong>Category</strong>: {category}\r\n          </li>\r\n          <li>\r\n            <strong>Publish date</strong>: {date}\r\n          </li>\r\n          <li>\r\n            <strong>Project URL</strong>: {githublink}\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <div className=\"portfolio-description\">\r\n        <h2>Summary</h2>\r\n        <p>{summary}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default ArticleInfo;\r\n","import React from \"react\";\r\nimport Breadcrumbs from \"../breadcrumbs\";\r\nimport ArticleInfo from \"./articleinfo\";\r\nimport Gist from \"react-gist\";\r\n\r\nimport ArticleImage from \"../../assets/img/articles/optimizememallocation1.png\";\r\n\r\nconst Article = () => {\r\n  const summary =\r\n    \"A simple technique to avoid Garbage Collector (GC) pressure for large applications where GC performance is a must.\";\r\n  // <!-- ======= Portfolio Details Section ======= -->\r\n  return (\r\n    <React.Fragment>\r\n      <Breadcrumbs title=\"Optimize Memory Allocation in a Producer / Consumer Pattern (C#)\" />\r\n      <section id=\"portfolio-details\" className=\"portfolio-details\">\r\n        <div className=\"container\">\r\n          <div className=\"row gy-4\">\r\n            <div className=\"col-lg-8\">\r\n              <h2>Introduction</h2>\r\n              <p>\r\n                Consumer / Producer Pattern is an example of a multi-thread synchronization problem: two threads, one producing data and another consuming data.\r\n              </p>\r\n              <p>The produced data usually comes from a external system or component and needs to be transformed into a new structure (DTO) known and designed to be used by the consumer (this allows, for example, avoid coupling between the two systems or components).</p>\r\n              <p>This transformation means creating new objects, and for large applications, where memory allocation must be optimized, to avoid Garbage Collection, if the produced data is significant this will create additional GC pressure and you will start seeing performance issues.</p>\r\n              <p>This article shows an example using an ObjectPool (a concept similar to <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.buffers.arraypool-1?view=netcore-3.0\" target=\"_blank\"> ArrayPool</a>), but uses it for holding objects, to be reused and therefore minimize object creation.</p>\r\n              <p>The Producer / Consumer classes uses System.Threading.Channels and is based in the example described in this article.</p>\r\n              <p>The full code of this example can be found in <a href=\"https://github.com/rochar/ConsumerPRoducerObjectPoolSample\" target=\"_blank\">GitHub</a>.</p>\r\n\r\n              <h2>Object Pool Implementation</h2>\r\n              <p>The <em>ObjectPool</em> is responsible to keep created objects and to Rent them to any client requiring a new one. The client is responsible to Return it to the pool if not needed.</p>\r\n              <p>If no object is available in the pool the <em>Rent</em> method will create a new object using the _objectGenerator function, otherwise, will return an object from the pool.</p>\r\n              <p>The <em> Return</em> method will add the object back to the pool.</p>\r\n\r\n              <Gist id=\"35c703ee434284d1e5ebec994e1e2e49\"></Gist>\r\n              \r\n              <p>One important property in the maxElements that the pool can hold and this has to do with the problem you are trying to solve, it should be the minimum value that fits your problem: minimize object creation and minimize memory consumption.</p>\r\n\r\n              <h2>Producer / Consumer Implementation</h2>              \r\n              <h3>Producer</h3>\r\n             \r\n             <p>This producer simulate data being returned from a external system, it returns an <em>ExternalDto</em> (not owned by the component that we are developing) and maps it to a DomainDto (owned by our component) and adds it to the channel:</p>\r\n             <Gist id=\"59179a993d6d0db91e06649198010e25\"></Gist>\r\n             <h3>Consumer</h3>\r\n             <p>The consumer retrieves data from the channel and processes it:</p>\r\n             <Gist id=\"b6ed4db5577bb8f9a0a6482f479b35dd\"></Gist>\r\n\r\n             <h3>Producer With Pool</h3>\r\n             <p>Using the pool instead of creating a DomainDto, the producer rents it from the pool, so it can be a new object or an already existing one.</p>\r\n             <Gist id=\"ed580840c6e351a27dcc5679242f7870\"></Gist>\r\n             \r\n             <h3>Consumer With Pool</h3>\r\n             <p>The only difference is that the Consumer returns the object to the pool after processing it:</p>\r\n             <Gist id=\"eb5128efb86a67a0b6df98bda165b285\"></Gist>\r\n             \r\n             <h2>Benchmark</h2>\r\n            <p>The example on GitHub uses <a href=\"https://github.com/dotnet/BenchmarkDotNet\" target=\"_blank\">BenchmarkDotNet</a> to measure the allocated Memory and to compare performance. The benchmark simulates a producer / consumer with 100k, 1M and 5M objects produce and consumed:</p>\r\n              <figure className=\"text-center\">\r\n                <img src={ArticleImage} alt=\"Benchmark Results\" />\r\n                <figcaption className=\"figure-caption\">Benchmark Results</figcaption>\r\n              </figure>\r\n              <p>The Delta between the memory Allocated itâ€™s the exact gain of using the Pool and not creating new objects. In this case the DomainDto is a very light class, even so we can see considerable gains for 100k objects.</p>\r\n              <p>For the performance: in the Mean we can not see any real difference, because DomainDto is light and so the creation of this object is not very expensive.</p>\r\n              <p>The correlation that seems to exists between the different results and variables (Median, Gen 0) is related to the fact that the producer/consumer are simulated and the produce/consumed elements are done at exactly same rate in the full execution. In a real world application this will not happen.</p>\r\n              <h2>Important considerations</h2>\r\n              <p>Remember the <em>maxElements</em>  parameter of <em>ObjectPools</em> class, this value should be related to the difference between producer and consumer throughput, if you are producing faster than consuming this value should be higher, otherwise can be lower. maxElements can be the expected produce elements in queue + delta.</p>\r\n              <hr></hr>\r\n              <h2>Conclusion</h2>\r\n              <p>If your application suffers from Garbage Collection and you are continuous creating and releasing objects consider to use ObjecPool concept. The Producer Consumer Pattern is a good place to include it.</p>\r\n              <p>Do measure your application for any change.</p>\r\n\r\n              <p>See you soon.</p>\r\n              \r\n            </div>\r\n            <ArticleInfo\r\n              category=\"C#\"\r\n              date=\"Nov 10, 2019\"\r\n              githuburl=\"https://github.com/rochar/ConsumerPRoducerObjectPoolSample\"\r\n              summary={summary}\r\n            ></ArticleInfo>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </React.Fragment>\r\n  );\r\n\r\n  {\r\n    /* <!-- End Portfolio Details Section --> */\r\n  }\r\n};\r\n\r\nexport default Article;\r\n","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst Breadcrumbs = ({ title }) => {\r\n  {\r\n    /* <!-- ======= Breadcrumbs ======= --> */\r\n  }\r\n  return (\r\n    <section id=\"breadcrumbs\" className=\"breadcrumbs\">\r\n      <div className=\"container\">\r\n        <div className=\"d-flex justify-content-between align-items-center\">\r\n          <h2>{title}</h2>\r\n          <ol>\r\n            <li>\r\n              <Link to=\"/\">Home</Link>\r\n            </li>\r\n            {/* <li>{title}</li> */}\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n  {\r\n    /* <!-- End Breadcrumbs --> */\r\n  }\r\n};\r\n\r\nexport default Breadcrumbs;\r\n","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport React from \"react\";\n\nvar Gist = /*#__PURE__*/function (_React$PureComponent) {\n  _inheritsLoose(Gist, _React$PureComponent);\n\n  function Gist() {\n    return _React$PureComponent.apply(this, arguments) || this;\n  }\n\n  var _proto = Gist.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this._updateIframeContent();\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(_prevProps, _prevState) {\n    this._updateIframeContent();\n  };\n\n  _proto._defineUrl = function _defineUrl() {\n    var _this$props = this.props,\n        id = _this$props.id,\n        file = _this$props.file;\n    var fileArg = file ? \"?file=\" + file : \"\";\n    return \"https://gist.github.com/\" + id + \".js\" + fileArg;\n  };\n\n  _proto._updateIframeContent = function _updateIframeContent() {\n    var _this$props2 = this.props,\n        id = _this$props2.id,\n        file = _this$props2.file;\n    var iframe = this.iframeNode;\n    var doc = iframe.document;\n    if (iframe.contentDocument) doc = iframe.contentDocument;else if (iframe.contentWindow) doc = iframe.contentWindow.document;\n\n    var gistLink = this._defineUrl();\n\n    var gistScript = \"<script type=\\\"text/javascript\\\" src=\\\"\" + gistLink + \"\\\"></script>\";\n    var styles = \"<style>*{font-size:12px;}</style>\";\n    var elementId = file ? \"gist-\" + id + \"-\" + file : \"gist-\" + id;\n    var resizeScript = \"onload=\\\"parent.document.getElementById('\" + elementId + \"').style.height=document.body.scrollHeight + 'px'\\\"\";\n    var iframeHtml = \"<html><head><base target=\\\"_parent\\\">\" + styles + \"</head><body \" + resizeScript + \">\" + gistScript + \"</body></html>\";\n    doc.open();\n    doc.writeln(iframeHtml);\n    doc.close();\n  };\n\n  _proto.render = function render() {\n    var _this = this;\n\n    var _this$props3 = this.props,\n        id = _this$props3.id,\n        file = _this$props3.file;\n    return /*#__PURE__*/React.createElement(\"iframe\", {\n      ref: function ref(n) {\n        _this.iframeNode = n;\n      },\n      width: \"100%\",\n      frameBorder: 0,\n      id: file ? \"gist-\" + id + \"-\" + file : \"gist-\" + id\n    });\n  };\n\n  return Gist;\n}(React.PureComponent);\n\nexport default Gist;"],"names":["githublink","category","date","githuburl","summary","href","target","className","title","id","src","ArticleImage","alt","to","_setPrototypeOf","o","p","Object","setPrototypeOf","__proto__","Gist","_React$PureComponent","subClass","superClass","apply","this","arguments","prototype","create","constructor","_proto","componentDidMount","_updateIframeContent","componentDidUpdate","_prevProps","_prevState","_defineUrl","_this$props","props","file","_this$props2","iframe","iframeNode","doc","document","contentDocument","contentWindow","iframeHtml","open","writeln","close","render","_this","_this$props3","React","ref","n","width","frameBorder"],"sourceRoot":""}